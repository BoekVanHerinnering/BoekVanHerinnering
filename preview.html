<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Verse Share Preview</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      display: flex;
      height: 100vh;
      background: #f3f3f3;
    }

    .panel {
      width: 300px;
      overflow-y: auto;
      background: #fff;
      padding: 15px;
      border-right: 1px solid #ccc;
    }

    .preview-container {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      background: #e0e0e0;
      position: relative;
    }

    #verseCard {
      width: 90%;
      max-width: 500px;
      min-height: 300px;
      background-color: rgba(255, 255, 255, 0.8);
      color: #111;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      text-align: center;
      overflow: auto;
      position: relative;
      z-index: 10;
    }

    #backgroundImage {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-size: cover;
      background-position: center;
      z-index: 1;
    }

    #overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.4);
      z-index: 5;
    }

    textarea {
      width: 100%;
      height: 100px;
      margin-bottom: 10px;
    }

    label {
      display: block;
      margin-top: 10px;
    }

    input[type="color"],
    input[type="range"],
    input[type="file"] {
      width: 100%;
    }

    .control-group {
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
  </style>
</head>
<body>

  <!-- Control Panel -->
  <div class="panel">
    <div class="control-group">
      <label>Font Size</label>
      <input type="range" min="12" max="36" id="fontSize" value="18">
    </div>
    <div class="control-group">
      <label>Font Color</label>
      <input type="color" id="fontColor" value="#111111">
    </div>
    <div class="control-group">
      <label>Background Image</label>
      <input type="file" id="bgUpload" accept="image/*">
    </div>
    <div class="control-group">
      <label>Overlay</label>
      <input type="color" id="overlayColor" value="#000000">
      <input type="range" min="0" max="100" value="40" id="overlayOpacity">
    </div>
  </div>

  <!-- Preview Area -->
  <div class="preview-container">
    <div id="backgroundImage"></div>
    <div id="overlay"></div>
    <div id="verseCard">
      <div id="verseText">Loading versesâ€¦</div>
    </div>
  </div>

  <script src="https://unpkg.com/@panzoom/panzoom@9.4.0/dist/panzoom.min.js"></script>
  <script>
    // Load verses from sessionStorage
    const params = new URLSearchParams(window.location.search);
    const data = JSON.parse(decodeURIComponent(params.get('data') || '{}'));
    document.getElementById('verseText').innerText = data.text || 'No verse data found.';

    // Font size control
    document.getElementById('fontSize').addEventListener('input', e => {
      document.getElementById('verseCard').style.fontSize = e.target.value + 'px';
    });

    // Font color control
    document.getElementById('fontColor').addEventListener('input', e => {
      document.getElementById('verseCard').style.color = e.target.value;
    });

    // Background image upload
    document.getElementById('bgUpload').addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        document.getElementById('backgroundImage').style.backgroundImage = `url('${reader.result}')`;
        setupPanzoom(); // Re-setup zoom
      };
      reader.readAsDataURL(file);
    });

    // Overlay color and opacity
    function updateOverlay() {
      const color = document.getElementById('overlayColor').value;
      const opacity = document.getElementById('overlayOpacity').value / 100;
      document.getElementById('overlay').style.background = hexToRgba(color, opacity);
    }

    document.getElementById('overlayColor').addEventListener('input', updateOverlay);
    document.getElementById('overlayOpacity').addEventListener('input', updateOverlay);
    updateOverlay();

    // Utility to convert hex to rgba
    function hexToRgba(hex, alpha) {
      const r = parseInt(hex.slice(1, 3), 16);
      const g = parseInt(hex.slice(3, 5), 16);
      const b = parseInt(hex.slice(5, 7), 16);
      return `rgba(${r}, ${g}, ${b}, ${alpha})`;
    }

    // Enable zooming only on the background
    function setupPanzoom() {
      const bg = document.getElementById('backgroundImage');
      Panzoom(bg, { maxScale: 3 });
    }
    setupPanzoom();
  </script>
</body>
</html>
